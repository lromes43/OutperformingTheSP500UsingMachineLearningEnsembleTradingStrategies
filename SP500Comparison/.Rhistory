print("Model 1 Accuracy")
accuracy(model1_pred$mean,valid_ts)
print("Model 2 Accuracy")
accuracy(model2_pred$mean,valid_ts)
print("Model 3 Accuracy")
accuracy(model3_pred$mean,valid_ts)
autoets_forecast_func <- function(x,h){
auto_ets_model <- ets(x, model = 'ZZZ', damped = F)
auto_ets_model_pred <- forecast(auto_ets_model, h = h, level = 90)
}
autoets_forecast_func <- function(x,h){
auto_ets_model <- ets(x, model = 'ZZZ', damped = F)
auto_ets_model_pred <- forecast(auto_ets_model, h = h, level = 90)
}
autoets_CVerr <- tsCV(commercial_ts,
forecastfunction = autoets_forecast_func,
h = 24,
initial = 120 - 1)
autoets_CV_MAE <- function(x){
mean(abs(x), na.rm = T)
}
MAE_func <- function(x){
mean(abs(x), na.rm = T)
}
model3_CV_MAE <- apply(autoets_CVerr, 2, MAE_func)
model3_CV_MAE
plot(model2_CV_MAE, ylim = c(1000,7000))
plot(model2_CV_MAE, ylim = c(1000,7000))
points(model3_CV_MAE, col = 'blue')
model3_CV_MAE <- apply(autoets_CVerr, 2, MAE_func)
plot(model2_CV_MAE, ylim = c(1000,7000))
points(model2_CV_MAE, lty = 'l')
plot(model2_CV_MAE, ylim = c(1000,7000))
points(model2_CV_MAE, col = 'black', lty = 'l')
autoets_CV_MAE <- apply(autoets_CVerr, 2, MAE_func)
plot(autoets_CV_MAE, ylim = c(1000,7000))
points(autoets_CV_MAE, col = 'black', lty = 'l')
plot(autoets_CV_MAE, ylim = c(1000,7000))
points(autoets_CV_MAE, col = 'black', type = 'l')
points(model2_CV_MAE, col = 'blue')
points(model2_CV_MAE, col = 'blue',type = 'l')
print("model2_CV accuracy")
accuracy(model2_pred$mean, valid_ts)
print("autoets_CV_MAE")
accuracy(auto_ets_model_pred$mean, valud.ts)
autoets_forecast_func <- function(x,h){
auto_ets_model <- ets(x, model = 'ZZZ', damped = F)
auto_ets_model_pred <- forecast(auto_ets_model, h = h, level = 90)
return(auto_ets_model_pred)
}
autoets_CVerr <- tsCV(commercial_ts,
forecastfunction = autoets_forecast_func,
h = 24,
initial = 120 - 1)
MAE_func <- function(x){
mean(abs(x), na.rm = T)
}
autoets_CV_MAE <- apply(autoets_CVerr, 2, MAE_func)
plot(autoets_CV_MAE, ylim = c(1000,7000))
points(autoets_CV_MAE, col = 'black', type = 'l')
points(model2_CV_MAE, col = 'blue')
points(model2_CV_MAE, col = 'blue',type = 'l')
print("model2_CV accuracy")
accuracy(model2_pred$mean, valid_ts)
print("autoets_CV_MAE")
accuracy(auto_ets_model_pred$mean, valud.ts)
plot(autoets_CV_MAE, ylim = c(1000,7000))
points(autoets_CV_MAE, col = 'black', type = 'l')
points(model2_CV_MAE, col = 'blue')
points(model2_CV_MAE, col = 'blue',type = 'l')
points(commercial_ts, col = 'red')
rm(list=ls())
library(forecast)
library(readxl)
library(ggplot2)
Amtrak.data <- read_excel("AmtrakRidership.xls")
Amtrak.data
Amtrak.ts <- ts(Amtrak.data$Ridership, start = c(1991,01), frequency = 12)
Amtrak.ts
plot(Amtrak.ts)
seasonplot(Amtrak.ts)
Amtrak.data <- read_excel("AmtrakRidership.xls")
Amtrak.ts <- ts(Amtrak.data$Ridership, start = c(1991,01), frequency = 12)
plot(Amtrak.ts)
plot(Amtrak.ts)
nTotal <- length(Amtrak.ts)
nTotal
nvalid <- 3*12
nTrain <- nTotal - nTrain
nTrain <- nTotal - nvalid
nTrain
train.ts <- window(Amtrak.ts, start =(1991,1), end = (1991, nTrain))
train.ts <- window(Amtrak.ts, start =c(1991,1), end = c(1991, nTrain))
train.ts
valid.ts <- window(Amtrak.ts, start = c(1991, nTrain + 1))
valid.ts
model1 <- ets(train.ts, model = 'AAA', damped = F)
model1d <- ets(train.ts, model = 'AAA', damped = T)
plot(train.ts)
plot(train.ts)
lines(model1$fitted, col = 'red')
lines(model1d$fitted, col = 'blue')
linmodel <- tslm(train.ts~trend+season)
plot(train.ts)
lines(model1$fitted, col = 'red')
lines(model1d$fitted, col = 'blue')
lines(linmodel$fitted.values, col = 'brown')
model2 <- ets(train.ts, model = 'MAM', damped = F)
model2d <- ets(train.ts, model = 'MAM', damped = T)
plot(train.ts)
lines(model2$fitted, col = 'red')
lines(model2d$fitted, col = 'blue')
automodel <- ets(train.ts, model = 'ZZZ')
automodel
model1_pred <- forecast(model1, h = nvalid, level = 90)
model1d_pred <- forecast(model1d, h = nvalid, level = 90)
model2_pred <- forecast(model2, h = nvalid, level = 90)
model2d_pred <- forecast(model2d, h = nvalid, level = 90)
automodel_pred <- forecast(automodel, h = nvalid, level = 90)
model1_pred <- forecast(model1, h = nvalid, level = 90)
accuracy(model1_pred$mean, valid.ts)
model1d_pred <- forecast(model1d, h = nvalid, level = 90)
accuracy(model1d_pred$mean, valid.ts)
model2_pred <- forecast(model2, h = nvalid, level = 90)
accuracy(model2_pred$mean, valid.ts)
model2d_pred <- forecast(model2d, h = nvalid, level = 90)
accuracy(model2d_pred$mean, valid.ts)
automodel_pred <- forecast(automodel, h = nvalid, level = 90)
accuracy(automodel_pred$mean, valid.ts)
mean(valid.ts)
plot(model1_pred)
lines(valid.ts)
lines(model1d_pred$mean, col='red')
model1_pred <- forecast(model1, h = nvalid, level = 90)
accuracy(model1_pred$mean, valid.ts)
model1d_pred <- forecast(model1d, h = nvalid, level = 90)
accuracy(model1d_pred$mean, valid.ts)
model2_pred <- forecast(model2, h = nvalid, level = 90)
accuracy(model2_pred$mean, valid.ts)
model2d_pred <- forecast(model2d, h = nvalid, level = 90)
accuracy(model2d_pred$mean, valid.ts) #did the best
automodel_pred <- forecast(automodel, h = nvalid, level = 90)
accuracy(automodel_pred$mean, valid.ts)
mean(valid.ts)
plot(model1_pred)
lines(valid.ts)
lines(model1d_pred$mean, col='red')
train.ts
length(train.ts)
168/12
init_position <- 10 *12 #start the CV after 10 years
h_ahead <- 24 # length of the validation paritition
#x is training data set, h is how far away going to forecast
#takes in training data and horizon and estimates h days ahead basedon hW
model1_forecast_function <- function(x,h){
model1 <- ets(x, model = 'AAA', damped = F)
model1_pred <- forecast(model1, h = h, level = 90)
return(model1_pred)
}
model1_cv_results <- tsCV(Amtrak.ts,
forecastfunction = model1_forecast_function,
h = h_ahead,
initial = init_position - 1)
mae_function <- function(x){
mean(abs(x), na.rm = T)
}
init_position <- 10 *12 #start the CV after 10 years
h_ahead <- 24 # length of the validation paritition
#x is training data set, h is how far away going to forecast
#takes in training data and horizon and estimates h days ahead basedon hW
model1_forecast_function <- function(x,h){
model1 <- ets(x, model = 'AAA', damped = F)
model1_pred <- forecast(model1, h = h, level = 90)
return(model1_pred)
}
mae_function <- function(x){
mean(abs(x), na.rm = T)
}
model1_cv_results <- tsCV(Amtrak.ts,
forecastfunction = model1_forecast_function,
h = h_ahead,
initial = init_position - 1)
apply(model1_cv_results, 2, mae_function)
model1d_forecast_func <- function(x,h){
model1d <- ets(x, model = 'AAA', damped = T)
model1d_pred <- forecast(model1d, h = h, level = 90)
}
mae_function function(x){
mae_function <- function(x){
mean(abs(x), na.rm = T)
}
model1d_forecast_func <- function(x,h){
model1d <- ets(x, model = 'AAA', damped = T)
model1d_pred <- forecast(model1d, h = h, level = 90)
}
mae_function <- function(x){
mean(abs(x), na.rm = T)
}
model1d_cv_results <- tsCV(Amtrak.ts,
forecastfunction = model1d_forecast_func,
h = h_ahead,
initial = init_position -1)
model1d_mae <- apply(model1d_cv_results, 2, mae_function)
plot(Amtrak.ts)
lines(model1d_mae, col = 'blue')
lines(model1_MAE, col = 'red')
plot(Amtrak.ts)
lines(model1d_mae, col = 'blue')
lines(model1MEA, col = 'red')
model1_MAE <- apply(model1_cv_results, 2, mae_function)
plot(Amtrak.ts)
lines(model1d_mae, col = 'blue')
lines(model1_MAE, col = 'red')
plot(model1d_mae)
lines(model1_MAE, col = 'red')
nile_ts <- window(Nile, start=1902)
nile_ts
library(forecast)
model1 <- Arima(nile_ts, order = c(1,0,1))
model1_pred <- forecast(model1, h =10)
model1_pred
naive(nile_ts, h = 10)
auto_model <- auto.arima(nile_ts, d=0, seasonal = F)
auto_model
h = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
}
h = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h_ahead = h,
initial =init -1
)
h = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h_ahead = h,
initial =init -1
)
ar1_cv = apply(ar1_cv, 2, mae_func)
ar1_cv
h = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h_ahead = h,
initial =init -1
)
h = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h_ahead = h,
initial =init -1
)
ar1_cv = apply(ar1_cv, 2, mae_func)
h_ahead = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
return(ar1_pred)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h = h_ahead,
initial =init -1
)
ar1_cv = apply(ar1_cv, 2, mae_func)
ar1_cv
tail(ar1_cv)
ar1_cv[-1]
h_ahead = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
return(ar1_pred)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h = h_ahead,
initial =init -1
)
ar1_cv = apply(ar1_cv, 2, mae_func)
ar1_cv
h_ahead = 5
init = 20
randomwalk_forecast_func <- function(x,h){
randomwalk <- naive(x, h = h)
return(randomwalk)
}
randomwalk_cv <- tsCV(nile_ts,
forecastfunction = randomwalk_forecast_func,
h = h_ahead,
initial = init)
h_ahead = 5
init = 20
randomwalk_forecast_func <- function(x,h){
randomwalk <- naive(x, h = h)
return(randomwalk)
}
randomwalk_cv <- tsCV(nile_ts,
forecastfunction = randomwalk_forecast_func,
h = h_ahead,
initial = init)
ra_cv <- apply(randomwalk_cv, 2, mae_func)
h_ahead = 5
init = 20
randomwalk_forecast_func <- function(x,h){
randomwalk <- naive(x, h = h)
return(randomwalk)
}
randomwalk_cv <- tsCV(nile_ts,
forecastfunction = randomwalk_forecast_func,
h = h_ahead,
initial = init)
ra_cv <- apply(randomwalk_cv, 2, mae_func)
ra_cv
h_ahead = 5
init = 20
randomwalk_forecast_func <- function(x,h){
randomwalk <- naive(x, h = h)
return(randomwalk)
}
randomwalk_cv <- tsCV(nile_ts,
forecastfunction = naive,
h = h_ahead,
initial = init)
ra_cv <- apply(randomwalk_cv, 2, mae_func)
ra_cv
h_ahead = 5
init = 20
randomwalk_forecast_func <- function(x,h){
randomwalk <- naive(x, h = h)
return(randomwalk)
}
randomwalk_cv <- tsCV(nile_ts,
forecastfunction = naive,
h = h_ahead,
initial = init - 1)
ra_cv <- apply(randomwalk_cv, 2, mae_func)
ra_cv
h_ahead = 5
init = 20
ar1_forecast_function <- function(x, h){
ar1 <- Arima(x, order = c(1,0,0))
ar1_pred <- forecast(ar1, h = h)
return(ar1_pred)
}
mae_func <- function(x){
mean(abs(x), na.rm = T)
}
ar1_cv <- tsCV(nile_ts,
forecastfunction = ar1_forecast_function,
h = h_ahead,
initial =init -1
)
ar1_cv = apply(ar1_cv, 2, mae_func)
ar1_cv
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(forecast)
data <- read.table("co2_monthly.txt", header = T)
co2_ts <- ts(data$value, start =c(1985,6), frequency = 12)
co2_ts_sub <- window(co2_ts, start = c(2015,1))
xreg = cbind(seq_along(co2_ts_sub), seasonaldummy(co2_ts_sub))
model3 <- auto.arima(co2_ts_sub, xreg = xreg)
model3
model3$arma
# Fit model explicitly without seasonal components
xreg = cbind(seq_along(co2_ts_sub), seasonaldummy(co2_ts_sub))
model3 <- auto.arima(co2_ts_sub, xreg = xreg, seasonal = FALSE)
# Print only the ARIMA error process
model3$arma  # shows AR, MA orders and seasonal info
model3
rm(list=ls())
library(forecast)
library(fpp2)
walmart_data <- read.csv("./walmart_data.csv")
walmart_ts <- ts(walmart_data$sales, start = c(2010,6), frequency = 52)
plot(walmart_ts)
rm(list=ls())
library(prophet)
library(forecast)
library(readxl)
Amtrak_data <- read_excel("./AmtrakRidership.xls")
Amtrak_ts <- ts(Amtrak_data$Ridership, start=c(1991,1), end=c(2004,12), freq=12)
nTotal <- length(Amtrak_ts)
nValid <- 3*12
nTrain <- nTotal - nValid
train_ts<- window(Amtrak_ts, start=c(1991,1), end=c(1991, nTrain))
valid_ts <- window(Amtrak_ts, start=c(1991, nTrain+1), end=c(1991, nTrain+nValid))
plot(Amtrak_ts)
abline(v=time(train_ts)[nTrain], lty=2)
model1 <- tslm(train_ts~trend + seasonal())
model1 <- tslm(train_ts~trend + season)
model2 <- auto.arima(train_ts)
model1
model2
plot(train_ts)
lines(model1$fitted.values, col='blue')
xreg <- cbind(seq_along(train_ts, nValid), seasonaldummy(train_ts))
xreg <- cbind(seq_along(train_ts), seasonaldummy(train_ts))
xreg
xreg <- cbind(seq_along(train_ts), seasonaldummy(train_ts))
model3 <- auto.arima(train_ts, xreg = xreg)
model3
plot(train_ts)
lines(model3$fitted, col='blue')
model4 <- nnetar(train_ts, p =3, P =1, size = 5, xreg = xreg) #k is size
plot(train_ts)
lines(model4$fitted, col = 'blue')
set.seed(7)
model4 <- nnetar(train_ts, p =3, P =1, size = 5, xreg = xreg) #k is size
plot(train_ts)
lines(model4$fitted, col = 'blue') #when I train a NN there will be some randomness need to set seed
model4
newxreg <-  cbind(trend = seq_along(valid_ts), seasonaldummy(valid_ts))
model1_pred <- forecast(model1, h=nValid, level=90)
model2_pred <- forecast(model2, h=nValid, level=90)
model3_pred <- forecast(model3, h=nValid, level=90, xreg=newxreg)
model4_pred <- forecast(model4, h=nValid, level=90, xreg=newxreg)
plot(model4_pred)
newxreg <-  cbind(trend = seq_along(valid_ts) + nTrain, seasonaldummy(valid_ts))
model1_pred <- forecast(model1, h=nValid, level=90)
model2_pred <- forecast(model2, h=nValid, level=90)
model3_pred <- forecast(model3, h=nValid, level=90, xreg=newxreg)
model4_pred <- forecast(model4, h=nValid, level=90, xreg=newxreg)
plot(model4_pred)
accuracy(model1_pred$mean, valid_ts)
accuracy(model2_pred$mean, valid_ts)
accuracy(model3_pred$mean, valid_ts)
accuracy(model4_pred$mean, valid_ts)
# Prepare the training data for prophet
train_ts_prophet <- data.frame(ds=seq(from=as.Date('1991-01-01'), by='month', length.out=nTrain),
y=train_ts)
model5 <- prophet(train_ts_prophet)
# Use the predict() function to generate fitted value of prophet on the training data
fitted_fcst <- predict(model5, train_ts_prophet)
plot(model5, fitted_fcst)
# Note the fitted trend is not a simple linear line
prophet_plot_components(model5, fitted_fcst)
# generate the forecast horizon for prophet
future_horizon <- make_future_dataframe(model5, periods=nValid, freq='month')
model5_fcst <- predict(model5, future_horizon)
# plot the fitted value in the training data and forecast value in the validation data
plot(model5, model5_fcst)
# forecast value of the validation data by prophet
model5_pred <- model5_fcst$yhat[-c(1:nTrain)]
accuracy(model5_pred, valid_ts)
knitr::opts_chunk$set(echo = TRUE)
library(forecast)
library(tidyverse)
setwd("~/Desktop/Personal/Sp500Project/SP500Comparison")
model = read_csv("modelovertime.csv")
sp500_act = read_csv("sp500_final.csv")
model
plot(model)
?ts()
model_ts <- ts(model, start =(2025-09-04), frequency = 365)
model_ts
sp500_act
sp500_ts <- ts(sp500_act, start = (2025-09-04, frequency = 365)
sp500_ts <- ts(sp500_act, start = (2025-09-04), frequency = 365)
sp500_ts
plot(model_ts)
model = read_csv("modelovertime.csv")
sp500_act = read_csv("sp500_final.csv")
model_ts <- ts(model$change, start =(2025-09-04), frequency = 365)
sp500_ts <- ts(sp500_act$change, start = (2025-09-04), frequency = 365)
plot(model_ts)
plot(model_ts) +
lines(sp500_ts, color = 'blue')
plot(model_ts) +
lines(sp500_ts, col = 'blue')
