---
title: "Untitled"
format: html
---

```{python}
import pandas as pd
import yfinance as yf
import numpy as np
from plotnine import *
```

```{python}
data = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/SP500Initial.csv")
data.head()
```


```{python}
daily_return = []
for i in range(0, len(data)):
    previous_price = data['Close'].iloc[i-1]
    current_price = data['Close'].iloc[i]
    daily_return_rate = ((current_price - previous_price)/previous_price) * 100
    daily_return.append(daily_return_rate)

data['Daily_Return'] =  daily_return
data
```


```{python}
price_range = []
for i in range(0, len(data)):
    high = data['High'].iloc[i]
    low = data['Low'].iloc[i]
    p_range = high - low
    price_range.append(p_range)

price_range
data['Day_Range'] =   price_range
data
```


```{python}

data['SMA_5'] = data.groupby('Ticker')['Close'].rolling(window=5, min_periods=1).mean().reset_index(level=0, drop = True)
data['SMA_12'] = data.groupby('Ticker')['Close'].rolling(window = 12, min_periods=1).mean().reset_index(level=0, drop=True)
data['SMA_15'] = data.groupby('Ticker')['Close'].rolling(window=15, min_periods=1).mean().reset_index(level=0, drop = True)
data['SMA_20'] = data.groupby('Ticker')['Close'].rolling(window = 20, min_periods=1).mean().reset_index(level = 0, drop=True) #made so can calc bollinger bands
data['SMA_26'] = data.groupby('Ticker')['Close'].rolling(window=26, min_periods=1).mean().reset_index(level=0, drop=True)
data['SMA_30'] = data.groupby('Ticker')['Close'].rolling(window=30, min_periods=1).mean().reset_index(level=0, drop = True)
data['SMA_50'] = data.groupby('Ticker')['Close'].rolling(window=50, min_periods=1).mean().reset_index(level=0, drop = True)
data
```


```{python}

##Manual WAY!

#want to find EMA for N = 50,26,12, and 5
#EMA formula:  Price current  * (2/N+1) +EMA previous * ( 1- (2/N+1)) 

ticker_list = data['Ticker'].unique() 

subset = data[data['Ticker'] == "CSCO"].copy()

price_current = subset['Close'].iloc[0]

ema_previous = subset['SMA_50'].iloc[0]

N = 50
K = (2/N+1)

first_row_index = subset.index[0]
subset.loc[first_row_index, 'EMA_50'] = price_current * K + ema_previous * (1 - K)

subset
```

```{python}
#EMA
def ema_formula(price_current, ema_previous, N):
    K = 2/(N+1)
    return price_current * K + ema_previous * (1 - K)
```

```{python}
EMA_5 = []

for ticker in data["Ticker"].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_ema = []
    N = 5
    print(ticker)
    for i in range(0, len(subset)):
        print(i)
        price_current = subset['Close'].iloc[i]
        print(price_current)
        if  i == 0:
            ema_previous = subset['SMA_5'].iloc[0]
        else:
            ema_previous = EMA
        EMA = ema_formula(price_current, ema_previous, N)
        print(EMA)
        individual_ema.append(EMA)
    subset['EMA_5'] = individual_ema
    EMA_5.append(subset)

data = pd.concat(EMA_5, ignore_index=True)
data
```

```{python}

EMA_12 = []

for ticker in data["Ticker"].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_ema = []
    N = 12
    print(ticker)
    for i in range(0, len(subset)):
        print(i)
        price_current = subset['Close'].iloc[i]
        print(price_current)
        if  i == 0:
            ema_previous = subset['SMA_12'].iloc[0]
        else:
            ema_previous = EMA
        EMA = ema_formula(price_current, ema_previous, N)
        print(EMA)
        individual_ema.append(EMA)
    subset['EMA_12'] = individual_ema
    EMA_12.append(subset)

data= pd.concat(EMA_12, ignore_index=True)
data
```

```{python}
EMA_26 = []

for ticker in data["Ticker"].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_ema = []
    N = 26
    print(ticker)
    for i in range(0,len(subset)):
        print(i)
        price_current = subset['Close'].iloc[i]
        print(price_current)
        if i == 0:
            ema_previous = subset['SMA_26'].iloc[0]
        else:
            ema_previous = EMA
        EMA = ema_formula(price_current, ema_previous, N)
        print(EMA)
        individual_ema.append(EMA)
    subset['EMA_26'] = individual_ema
    EMA_26.append(subset)

data = pd.concat(EMA_26, ignore_index=True)
data
```

```{python}

EMA_50 = []

for ticker in data["Ticker"].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_ema = []
    N = 50
    print(ticker)
    for i in range(0,len(subset)): 
        print(i)
        price_current = subset['Close'].iloc[i]
        if i == 0:
            ema_previous = subset['SMA_50'].iloc[0]
        else:
            ema_previous = EMA
        EMA = ema_formula(price_current, ema_previous, N)
        individual_ema.append(EMA)
    subset['EMA_50'] = individual_ema
    EMA_50.append(subset)

data = pd.concat(EMA_50, ignore_index=True)
data
```

```{python}

MACD = []

def macd_formula(EMA_12, EMA_26):
    return EMA_12 - EMA_26


for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_macd = []
    print(ticker)
    for i in range(0,len(subset)):
        print(i)
        EMA_12 = subset['EMA_12'].iloc[i]
        EMA_26 = subset['EMA_26'].iloc[i]
        MACD_Vals = macd_formula(EMA_12, EMA_26)
        individual_macd.append(MACD_Vals)
    subset['MACD'] = individual_macd
    MACD.append(subset)

data = pd.concat(MACD, ignore_index=True)
data
```


```{python}
#RSI index by index

RSI = []
U = []
D = []
N = 14


subset = data[data['Ticker'] == 'CSCO']

change = subset['Close'].iloc[10] - subset['Close'].iloc[9]

if change > 0:
    U.append(Change)
    D.append(0)
else:
    U.append(0)
    D.append(abs(Change))

AU = np.sum(U) / N
AD = np.sum(D) / N
if AD == 0:
    RS = 100
else:
    RS = AU/AD
RSI = 100 - (100 / (1 + RS))
RSI

```


```{python}
#RSI looping through entire thing for one stock

RSI = []
U = []
D = []
N = 14

subset = data[data['Ticker'] == 'CSCO']
for i in range(1, len(subset)):
    change = subset['Close'].iloc[i] - subset['Close'].iloc[i -1 ]
    if change > 0:
        U.append(change)
        D.append(0)
    else:
        U.append(0)
        D.append(abs(change))
    AU = np.sum(U) / N
    AD = np.sum(D) / N
    if AD == 0:
        RS = 100
    else: 
        RS = AU/AD
    RSI_Vals = 100 - (100 / (1 + RS))
    RSI.append(RSI_Vals)

```

```{python}
#RSI looping through every stock every row

RSI = []
N = 14

for ticker in data['Ticker'].unique():
    U = []
    D = []
    individual_rsi = []
    subset = data[data['Ticker'] == ticker].copy()
    for i in range(0, len(subset)):
        change = subset['Close'].iloc[i] - subset['Close'].iloc[i -1 ]
        if change > 0: 
            U.append(change)
            D.append(0)
        else:
            U.append(0)
            D.append(abs(change))
        AU = np.sum(U) / N
        AD = np.sum(D) / N
        if AD == 0:
            RS = 100
        else: 
            RS = AU/AD
        RSI_Vals = 100 - (100 / (1 + RS))
        individual_rsi.append(RSI_Vals)
    subset['RSI'] = individual_rsi
    RSI.append(subset)

test = pd.concat(RSI, ignore_index=True)


```

Bollinger Bands:

Upper Band = 20 Day SMA + (20 DAY Standard Deviation * 2)
Middle Band = 20 Day SMA
Lower Band = 20 Day SMA - (20 DAY Standard Deviation * 2)

```{python}
#Middle Band
data = test
data['Bollinger_Band_Middle'] = data['SMA_20']


```

```{python}
#Calculates the SD for each
std_vals = data.groupby('Ticker')['Bollinger_Band_Middle'].std()
std_vals = std_vals.reset_index(name='SD')

```

```{python}
#Upper Band
SD_merge = pd.merge(data, std_vals, how = 'left', on = 'Ticker')
data = SD_merge
data.columns
data['Bollinger_Band_Upper'] = data['SMA_20'] +  2* data['SD']
data['Bollinger_Band_Lower'] = data['SMA_20'] -  2* data['SD']
```


On Balance Volume

```{python}
#calculate for one stock looping through

OBV = []
subset = data[data['Ticker'] == 'CSCO']

for i in range(1, len(subset)):
    close_change = subset['Close'].iloc[i] - subset['Close'].iloc[i-1]
    if close_change > 0:
        addend = subset['Volume']
    elif close_change < 0:
        addend = -(subset['Volume'])
    else: 
        addend = 0
    
    if i == 1:
        OBV_prev = 0
    else: 
        OBV_prev = OBV_individual[-1]
    OBV_val = OBV_prev + addend
    OBV.append(OBV_val)


test3 = pd.concat(OBV, ignore_index=True)
```


```{python}

OBV = []
for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    OBV_individual = []
    for i in range(len(subset)):
        if i == 0: 
            OBV_individual.append(0)
            continue

        close_change = subset['Close'].iloc[i] - subset['Close'].iloc[i-1]
        if close_change > 0: 
            addend = subset['Volume'].iloc[i]
        elif close_change < 0:
            addend = -(subset['Volume'].iloc[i])
        else: 
            addend = 0
       
        OBV_prev = OBV_individual[-1]
        OBV_val = OBV_prev + addend
        OBV_individual.append(OBV_val)
    subset['OBV'] = OBV_individual
    OBV.append(subset)
data = pd.concat(OBV, ignore_index=True)
```





```{python}
Day_to_Day_Diff = []

for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_d2d_diff = []
    print(ticker)
    for i in range(0,len(subset)):
        print(i)
        if i == 0:
            price_current = 0
            price_previous = 0
        else:
            price_current = subset['Close'].iloc[i]
            price_previous = subset['Close'].iloc[i-1]
        D2D_Diff_vals = price_current - price_previous
        individual_d2d_diff.append(D2D_Diff_vals)
    subset['Day_to_Day_Diff'] = individual_d2d_diff
    Day_to_Day_Diff.append(subset)
data = pd.concat(Day_to_Day_Diff, ignore_index=True)
```




```{python}
Day_to_Day_Percent_Diff = []

for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    individual_percent_diff = []
    for i in range(0, len(subset)):
        if i == 0:
            price_current = 0
            price_previous = 1000000000
        else: 
            price_current = subset['Close'].iloc[i]
            price_previous = subset['Close'].iloc[i-1]
        Percent_diff_values = ((price_current - price_previous) / price_previous) * 100
        individual_percent_diff.append(Percent_diff_values)
    subset['Day_to_Day_Percent_Diff'] = individual_percent_diff
    Day_to_Day_Percent_Diff.append(subset)

data = pd.concat(Day_to_Day_Percent_Diff, ignore_index=True)

```

```{python}
data.to_csv("FinalSP500DataWithDerived.csv", index=False)
```





Visuals for Short Report


```{python}
numeric_cols_subset = numeric_cols[numeric_cols['Date'] > '2025-10-01']
(ggplot(numeric_cols_subset, aes(x = 'Volume', y = 'Close')) + geom_point() + geom_smooth(color = 'blue')
)


```


```{python}
data2.dtypes
data2_subset = data[data2['Ticker'] == 'CSCO']
numeric_cols = data2_subset.drop(['Ticker'], axis=1)
ggplot(numeric_cols, aes(x='MACD', y= 'Close')) + geom_line() + theme_minimal() + labs(title = "MACD vs Close for CSCO Ticker")

```



```{python}
import pandas as pd
import yfinance as yf
data = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/DerivedVars.csv")
finaldf.head()
```

VIX

```{python}
ticker_symbol = "^VIX"
start_date = "2024-11-11"
end_date = "2025-11-10"


```

```{python}
try:
    vix_data = yf.download(
        tickers=ticker_symbol,
        start=start_date,
        end=end_date,
        interval="1d" 
    )

    vix_close_prices = vix_data['Close']

    print("VIX Closing Prices from {} to {}:".format(start_date, end_date))
    print(vix_close_prices)

except Exception as e:
    print(f"An error occurred: {e}")
```

```{python}
new = vix_close_prices.reset_index()
new.columns
test = pd.merge(data, new, how = 'left', on = 'Date')

```

Binary Classifier
```{python}
import pandas as pd
data = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FinalDataWithConsumerSentiment.csv")
data['Movement'] = (data['Day_to_Day_Diff'] > 0).astype(int)

data.to_csv("FINALDATA.csv", index=False)
```

Merging Earnings with Final Data
```{python}
import pandas as pd
original_data = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FINALDATA.csv")
earnings_data = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/earnings.csv")
```




```{python}
original_data['Earnings_Date'] = [None] * len(original_data)
og = original_data.sort_values(by = ['Ticker','Date'])
og = og.drop('Earnings_Date', axis = 1)
e = earnings_data.sort_values(by = ['Ticker', 'Date'])
```

```{python}
merged_df = pd.merge(left = og, 
                     right = e,
                     on = ['Date', 'Ticker'], 
                     how = 'left')
```

```{python}
import numpy as np
merged_df['earnings_bool'] = np.where(merged_df['EPS Estimate'].notna(), 1, 0)
```


Weekly Average for every stock
```{python}
weekly_averages = []
for t in merged_df['Ticker'].unique():
    subset = merged_df[merged_df['Ticker'] == t].reset_index().copy()
    individual_avgs = []
    for i in range(0, len(subset)):
        if i == 0:
            avg = subset['Close'].iloc[i]
        elif i == 1:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]))/2
        elif i ==2:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2])/3
        elif i ==3:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + merged_df['Close'].iloc[i-3])/4
        elif i >=4:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4])/5
        individual_avgs.append(float(avg))
    subset['weekly_averages'] = individual_avgs
    weekly_averages.append(subset)
    
test = pd.concat(weekly_averages, ignore_index=True)
data = test


```

Two-Week Average for every stock

```{python}

Two_week_averages = []
for t in merged_df['Ticker'].unique():
    subset = data[data['Ticker'] == t].reset_index().copy()
    individual_avgs = []
    for i in range(0, len(subset)):
        if i == 0:
            avg = subset['Close'].iloc[i]
        elif i == 1:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]))/2
        elif i ==2:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2])/3
        elif i ==3:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + merged_df['Close'].iloc[i-3])/4
        elif i ==4:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4])/5
        elif i ==5:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5])/6
        elif i ==6:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6])/7
        elif i ==7: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7])/8
        elif i ==8: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8])/9
        elif i ==9: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9])/10
        elif i ==10:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10])/11
        elif i ==11: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11])/12
        elif i ==12:
             avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12])/13
        elif i >= 13: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13])/14




        individual_avgs.append(float(avg))
    subset['Two_week_averages'] = individual_avgs
    Two_week_averages.append(subset)
    
test2 = pd.concat(Two_week_averages, ignore_index=True)
data = test2

```

One Month Average

```{python}

Monthly_Average = []

for t in merged_df['Ticker'].unique():
    subset = data[data['Ticker'] == t].reset_index(drop = True).copy()
    individual_avgs = []
    for i in range(0, len(subset)):
        if i == 0:
            avg = subset['Close'].iloc[i]
        elif i == 1:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]))/2
        elif i ==2:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2])/3
        elif i ==3:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + merged_df['Close'].iloc[i-3])/4
        elif i ==4:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4])/5
        elif i ==5:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5])/6
        elif i ==6:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6])/7
        elif i ==7: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7])/8
        elif i ==8: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8])/9
        elif i ==9: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9])/10
        elif i ==10:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10])/11
        elif i ==11: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11])/12
        elif i ==12:
             avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12])/13
        elif i == 13: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13])/14
        elif i ==14:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14])/15
        elif i ==15:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15])/16
        elif i ==16:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16])/17
        elif i ==17:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17])/18
        elif i ==18: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18])/19
        elif i ==19: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19])/20
        elif i ==20: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20])/21
        elif i ==21: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21])/22
        elif i ==22: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22])/23
        elif i ==23:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23])/24
        elif i ==24: 
             avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24])/25
        elif i ==25: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24] + subset['Close'].iloc[i-25])/26
        elif i ==26: 
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24] + subset['Close'].iloc[i-25] + subset['Close'].iloc[i-26])/27
        elif i ==27:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24] + subset['Close'].iloc[i-25] + subset['Close'].iloc[i-26] + subset['Close'].iloc[i-27])/28
        elif i ==28:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24] + subset['Close'].iloc[i-25] + subset['Close'].iloc[i-26] + subset['Close'].iloc[i-27] + subset['Close'].iloc[i-28])/29
        elif i >=29:
            avg = ((subset['Close'].iloc[i] + subset['Close'].iloc[i-1]) + subset['Close'].iloc[i-2] + subset['Close'].iloc[i-3] + subset['Close'].iloc[i-4] + subset['Close'].iloc[i-5] + subset['Close'].iloc[i-6] + subset['Close'].iloc[i-7] + subset['Close'].iloc[i-8] + subset['Close'].iloc[i-9]+ subset['Close'].iloc[i-10] + subset['Close'].iloc[i-11] + subset['Close'].iloc[i-12] + subset['Close'].iloc[i-13] + subset['Close'].iloc[i-14] + subset['Close'].iloc[i-15] + subset['Close'].iloc[i-16] + subset['Close'].iloc[i-17] + subset['Close'].iloc[i-18] + subset['Close'].iloc[1-19] + subset['Close'].iloc[i-20] + subset['Close'].iloc[i-21] + subset['Close'].iloc[i-22] + subset['Close'].iloc[i-23] + subset['Close'].iloc[i -24] + subset['Close'].iloc[i-25] + subset['Close'].iloc[i-26] + subset['Close'].iloc[i-27] + subset['Close'].iloc[i-28] + subset['Close'].iloc[i-29])/30
        individual_avgs.append(float(avg))
    subset['Monthly_Average'] = individual_avgs
    Monthly_Average.append(subset)
    
test2 = pd.concat(Monthly_Average, ignore_index=True)
data = test2
data = data.drop('index', axis = 1)

```


Standard Deviation of Last Week

```{python}
import numpy as np
Weekly_SD = []
for t in data['Ticker'].unique():
    subset = data[data['Ticker'] == t]
    individual_sd = []
    for i in range(0, len(subset)):
        if i ==0:
            sd = np.std(subset['Close'].iloc[i])
        elif i ==1:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1]])
        elif i ==2:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2]])
        elif i ==3:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3]])
        elif i >= 4:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4]])
        individual_sd.append(float(sd))
    subset['Weekly_SD'] = individual_sd
    Weekly_SD.append(subset)

test = pd.concat(Weekly_SD, ignore_index=True)
data = test
```

```{python}
data = data.drop('level_0', axis = 1)
```

Two Week Standard Deviation
```{python}
import numpy as np
Two_Week_SD = []
for t in data['Ticker'].unique():
    subset = data[data['Ticker'] == t]
    individual_sd = []
    for i in range(0, len(subset)):
        if i ==0:
            sd = np.std(subset['Close'].iloc[i])
        elif i ==1:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1]])
        elif i ==2:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2]])
        elif i ==3:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3]])
        elif i == 4:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4]])
        elif i ==5:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5]])
        elif i ==6:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6]])
        elif i ==7: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7]])
        elif i ==8: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8]])
        elif i ==9:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[1-9]])
        elif i ==10:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[1-9], subset['Close'].iloc[1-10]])
        elif i ==11:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11]])
        elif i ==12: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12]])
        elif i >=13:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13]])
        individual_sd.append(float(sd))
    subset['Two_Week_SD '] = individual_sd
    Two_Week_SD .append(subset)

test = pd.concat(Two_Week_SD , ignore_index=True)
data = test
```

Monhtly Standard Deviations

```{python}
import numpy as np
Monthly_SD = []
for t in data['Ticker'].unique():
    subset = data[data['Ticker'] == t]
    individual_sd = []
    for i in range(0, len(subset)):
        if i ==0:
            sd = np.std(subset['Close'].iloc[i])
        elif i ==1:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1]])
        elif i ==2:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2]])
        elif i ==3:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3]])
        elif i == 4:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4]])
        elif i ==5:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5]])
        elif i ==6:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6]])
        elif i ==7: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7]])
        elif i ==8: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8]])
        elif i ==9:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[1-9]])
        elif i ==10:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[1-9], subset['Close'].iloc[1-10]])
        elif i ==11:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11]])
        elif i ==12: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12]])
        elif i ==13:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13]])
        elif i ==14:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14]])
        elif i ==15:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15]])
        elif i ==16: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16]])
        elif i ==17: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17]])
        elif i ==18: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18]])
        elif i ==19: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19]])
        elif i ==20:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20]])
        elif i ==21:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21]])
        elif i ==22: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22]])
        elif i ==23:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23]])
        elif i ==24:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24]])
        elif i ==25:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24], subset['Close'].iloc[i-25]])
        elif i ==26:
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24], subset['Close'].iloc[i-25], subset['Close'].iloc[i-26]])
        elif i ==27: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24], subset['Close'].iloc[i-25], subset['Close'].iloc[i-26], 
            subset['Close'].iloc[i-27]])
        elif i ==28: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24], subset['Close'].iloc[i-25], subset['Close'].iloc[i-26], 
            subset['Close'].iloc[i-27], subset['Close'].iloc[i-28]])
        elif i >=29: 
            sd = np.std([subset['Close'].iloc[i], subset['Close'].iloc[i-1], subset['Close'].iloc[i-2], subset['Close'].iloc[i-3], subset['Close'].iloc[i-4], subset['Close'].iloc[i-5], subset['Close'].iloc[i-6], subset['Close'].iloc[i-7], subset['Close'].iloc[i-8], subset['Close'].iloc[i-9], subset['Close'].iloc[i-10], subset['Close'].iloc[i - 11], subset['Close'].iloc[i-12], subset['Close'].iloc[i-13], subset['Close'].iloc[i-14], subset['Close'].iloc[i-15], subset['Close'].iloc[i-16], subset['Close'].iloc[i-17], subset['Close'].iloc[i-18], subset['Close'].iloc[i-19], subset['Close'].iloc[i-20], subset['Close'].iloc[i-21], subset['Close'].iloc[i-22], subset['Close'].iloc[i-23], subset['Close'].iloc[i-24], subset['Close'].iloc[i-25], subset['Close'].iloc[i-26], 
            subset['Close'].iloc[i-27], subset['Close'].iloc[i-28], subset['Close'].iloc[i-29]])
        individual_sd.append(float(sd))
    subset['Monthly_SD'] = individual_sd
    Monthly_SD.append(subset)

test = pd.concat(Monthly_SD, ignore_index=True)
data = test
```

Saving to feather so smaller file size
```{python}
data.to_feather('FinalDataNoStockSplit.feather')
```

Loading in Created feather file
```{python}
import pandas as pd
data = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FinalDataNoStockSplit.feather")
```

Pulling all the stock splits from companies in SP500 in selected dates

```{python}
import yfinance as yf
import pandas as pd

tickers_list = data['Ticker'].unique().tolist() 
tickers = tickers_list 

start = "2024-11-11"
end = "2025-11-10"

all_splits = []

for t in tickers:
    ticker_splits = yf.Ticker(t).splits 
    
    if ticker_splits is not None and len(ticker_splits) > 0:
        temp = ticker_splits[(ticker_splits.index >= start) & (ticker_splits.index <= end)]
        for date, ratio in temp.items():
            all_splits.append({"Ticker": t, "Date": date, "Split Ratio": ratio})
            print(t, date, ratio)

df = pd.DataFrame(all_splits)
print(df)
```

```{python}
df.to_csv("StockSplitsDF.csv", index=False)
```

```{python}
split = pd.read_csv("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/StockSplitsDF.csv")
split['Date'] = pd.to_datetime(split['Date'], utc=True).dt.date
data['Date'] = pd.to_datetime(data['Date'], utc=True).dt.date
merged_df = pd.merge(data, split, how = 'left', left_on=['Date', 'Ticker'], right_on=['Date', 'Ticker'])


Split = []
for i in range(0, len(merged_df)):
    current_value = merged_df['Split Ratio'].iloc[i]
    if not pd.isna(current_value): 
        Split.append(1)
    else:
        Split.append(0)

merged_df['Split_Indicator'] = Split



```

5 Day Return %

```{python}
Five_Day_Percent_Diff_list = []

for ticker in merged_df['Ticker'].unique():
    subset = merged_df[merged_df['Ticker'] == ticker].copy()
    five_day_percent_diff = []
    
    for i in range(0, len(subset)):
        if i == 0:
           five_day_diff = (subset['Close'].iloc[i] - subset['Open'].iloc[i]) / subset['Open'].iloc[i]
        elif i == 1:
            five_day_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-1]) / subset['Close'].iloc[i-1]
        elif i == 2:
            
            five_day_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-2]) / subset['Close'].iloc[i-2]
        elif i == 3: 
            
            five_day_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-3]) / subset['Close'].iloc[i-3]
        elif i >= 4: 
           
            five_day_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-4]) / subset['Close'].iloc[i-4]
        five_day_percent_diff.append(five_day_diff)
    subset['Five_Day_Percent_Diff'] = five_day_percent_diff 
    Five_Day_Percent_Diff_list.append(subset)

test = pd.concat(Five_Day_Percent_Diff_list, ignore_index=True)
```


Reordering Columns
```{python}
cols_reordered = [
    'Date', 'Open', 'High', 'Low', 'Close', 'Volume', 'Ticker', 'Day_Range', 
    'SMA_5', 'SMA_12', 'SMA_15', 'SMA_20', 'SMA_26', 'SMA_30', 'SMA_50', 
    'EMA_5', 'EMA_12', 'EMA_26', 'EMA_50', 'MACD', 'RSI', 'Bollinger_Band_Middle', 
    'SD', 'Bollinger_Band_Upper', 'Bollinger_Band_Lower', 'OBV', '^VIX', 
    'EPS Estimate', 'Reported EPS', 'Surprise(%)', 'earnings_bool', 
    'Split Ratio',        
    'Split_Indicator', 'Daily_Return', 'Day_to_Day_Diff', 
    'Day_to_Day_Percent_Diff', 'Five_Day_Percent_Diff', 
    'weekly_averages', 'Two_week_averages', 'Monthly_Average', 
    'Weekly_SD', 
    'Two_Week_SD ',      
    'Monthly_SD', 'Movement'
]


df_reordered = test.loc[:, cols_reordered]
df_reordered.to_feather("FINALSP00Data.feather")
```



```{python}
import pandas as pd

data = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FINALSP00Data.feather")

```


2 week return

```{python}

Two_Week_Percent_Diff= []

for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    two_week_percent_diff = []
    
    for i in range(0, len(subset)):
        if i == 0:
           two_week_diff = (subset['Close'].iloc[i] - subset['Open'].iloc[i]) / subset['Open'].iloc[i]
        elif i == 1:
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-1]) / subset['Close'].iloc[i-1]
        elif i == 2:
            two_week_diff  = (subset['Close'].iloc[i] - subset['Close'].iloc[i-2]) / subset['Close'].iloc[i-2]
        elif i == 3: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-3]) / subset['Close'].iloc[i-3]
        elif i == 4: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-4]) / subset['Close'].iloc[i-4]
        elif i == 5: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-5]) / subset['Close'].iloc[i-5]
        elif i ==6: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-6]) / subset['Close'].iloc[i-6]
        elif i ==7: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-7]) / subset['Close'].iloc[i-7]
        elif i ==8: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-8]) / subset['Close'].iloc[i-8]
        elif i ==9:
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-9]) / subset['Close'].iloc[i-9]
        elif i ==10: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-10]) / subset['Close'].iloc[i-10]
        elif i ==11: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-11]) / subset['Close'].iloc[i-11]
        elif i ==12:
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-12]) / subset['Close'].iloc[i-12]
        elif i >=13: 
            two_week_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-13]) / subset['Close'].iloc[i-13]
        two_week_percent_diff.append(two_week_diff)
    subset['Two_Week_Percent_Diff'] =  two_week_percent_diff
    Two_Week_Percent_Diff.append(subset)

test = pd.concat(Two_Week_Percent_Diff, ignore_index=True)
```


30 Day Return 


```{python}
data = test

Monthly_Percent_Diff= []
for ticker in data['Ticker'].unique():
    subset = data[data['Ticker'] == ticker].copy()
    monthly_percent_diff = []
    
    for i in range(0, len(subset)):
        if i == 0:
           month_diff = (subset['Close'].iloc[i] - subset['Open'].iloc[i]) / subset['Open'].iloc[i]
        elif i == 1:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-1]) / subset['Close'].iloc[i-1]
        elif i == 2:
            month_diff  = (subset['Close'].iloc[i] - subset['Close'].iloc[i-2]) / subset['Close'].iloc[i-2]
        elif i == 3: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-3]) / subset['Close'].iloc[i-3]
        elif i == 4: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-4]) / subset['Close'].iloc[i-4]
        elif i == 5: 
            month_diff= (subset['Close'].iloc[i] - subset['Close'].iloc[i-5]) / subset['Close'].iloc[i-5]
        elif i ==6: 
            month_diff= (subset['Close'].iloc[i] - subset['Close'].iloc[i-6]) / subset['Close'].iloc[i-6]
        elif i ==7: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-7]) / subset['Close'].iloc[i-7]
        elif i ==8: 
            month_diff= (subset['Close'].iloc[i] - subset['Close'].iloc[i-8]) / subset['Close'].iloc[i-8]
        elif i ==9:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-9]) / subset['Close'].iloc[i-9]
        elif i ==10: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-10]) / subset['Close'].iloc[i-10]
        elif i ==11: 
            month_diff= (subset['Close'].iloc[i] - subset['Close'].iloc[i-11]) / subset['Close'].iloc[i-11]
        elif i ==12:
            month_diff= (subset['Close'].iloc[i] - subset['Close'].iloc[i-12]) / subset['Close'].iloc[i-12]
        elif i ==13: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-13]) / subset['Close'].iloc[i-13]
        elif i ==14: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-14]) / subset['Close'].iloc[i-14]
        elif i ==15:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-15]) / subset['Close'].iloc[i-15]
        elif i ==16: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-16]) / subset['Close'].iloc[i-16]
        elif i ==17: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-17]) / subset['Close'].iloc[i-17]
        elif i ==18:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-18]) / subset['Close'].iloc[i-18]
        elif i ==19: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-19]) / subset['Close'].iloc[i-19]
        elif i ==20:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-20]) / subset['Close'].iloc[i-20]
        elif i ==21:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-21]) / subset['Close'].iloc[i-21]
        elif i ==22: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-22]) / subset['Close'].iloc[i-22]
        elif i ==23:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-23]) / subset['Close'].iloc[i-23]
        elif i ==24:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-24]) / subset['Close'].iloc[i-24]
        elif i ==25:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-25]) / subset['Close'].iloc[i-25]
        elif i ==26:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-26]) / subset['Close'].iloc[i-26]
        elif i ==27:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-27]) / subset['Close'].iloc[i-27]
        elif i ==28:
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-28]) / subset['Close'].iloc[i-28]
        elif i >=29: 
            month_diff = (subset['Close'].iloc[i] - subset['Close'].iloc[i-29]) / subset['Close'].iloc[i-29]
        monthly_percent_diff.append(month_diff)
    subset['Monthly_Percent_Diff'] =  monthly_percent_diff
    Monthly_Percent_Diff.append(subset)

test = pd.concat(Monthly_Percent_Diff, ignore_index=True)
```




```{python}
cols_reordered = [
    'Date', 'Open', 'High', 'Low', 'Close', 'Volume', 'Ticker', 'Day_Range',
       'SMA_5', 'SMA_12', 'SMA_15', 'SMA_20', 'SMA_26', 'SMA_30', 'SMA_50',
       'EMA_5', 'EMA_12', 'EMA_26', 'EMA_50', 'MACD', 'RSI',
       'Bollinger_Band_Middle', 'SD', 'Bollinger_Band_Upper',
       'Bollinger_Band_Lower', 'OBV', '^VIX', 'EPS Estimate', 'Reported EPS',
       'Surprise(%)', 'earnings_bool', 'Split Ratio', 'Split_Indicator',
    'weekly_averages','Weekly_SD',  'Two_week_averages', 'Two_Week_SD ', 'Monthly_SD','Monthly_Average', 'Daily_Return', 'Day_to_Day_Diff', 'Day_to_Day_Percent_Diff',
       'Five_Day_Percent_Diff',
       'Movement', 'Two_Week_Percent_Diff', 'Monthly_Percent_Diff'
]




df_reordered = test.loc[:, cols_reordered]
```

```{python}
data = df_reordered
data.to_feather("FINALDATANov26.feather")
```


```{python}
final = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FINALDATANov26.feather")
final
```