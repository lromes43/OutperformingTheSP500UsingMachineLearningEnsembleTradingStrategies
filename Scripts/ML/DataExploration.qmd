---
title: "Untitled"
format: html
---

Installing Necessary Packages
```{python}
import pandas as pd
import numpy as np
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, ConfusionMatrixDisplay
from sklearn import preprocessing
from sklearn.ensemble import BaggingClassifier
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import cross_val_score
from sklearn.inspection import partial_dependence
import matplotlib.pyplot as plt
import dtreeviz
from datetime import date
from plotnine import *
```

Loading in Data

```{python}
data = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/FINALDATANov26.feather")
```

Split between train and test, going to do via subsetting and have 80% in train, 20% in test

Goes from 11/11/2024 to 11/10/2025

```{python}
date1 = date(2024, 11, 11)
date2 = date(2025, 11, 10)
traintestsplit = 0.8 
total_days = (date2 - date1).days 
train_length_days = int(total_days * traintestsplit)
start_date_num= date1.toordinal()
stop_datenum_ = start_date_num+ train_length_days

train_stop_date = date.fromordinal(stop_datenum_)


```

Creating training and testing data
```{python}
data['Date'] = pd.to_datetime(data['Date'])
train_subset = data[data['Date'] <= '2025-8-29']
train_subset.to_feather("TrainData.feather")
test_subset = data[data['Date'] > '2025-8-29']
test_subset.to_feather("TestData.feather")
```

Loading in Train/Test Data
```{python}
train = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/TrainData.feather")
train['Movement'] = train['Movement'].astype('category')
test = pd.read_feather("/Users/lukeromes/Desktop/Personal/Sp500Project/Data/TestData.feather")
test['Movement'] = test['Movement'].astype('category')
```

Train/Test Initial Exploration
```{python}
distr_train = train['Movement'].describe()
train_distribution_up_movement_perc = int(distr_train[3]) / int(distr_train[0])
train_distribution_up_movement_perc 
train_distribution_down_movement_perc = int(distr_train[0] - distr_train[3]) / int(distr_train[0])
train_distribution_down_movement_perc 
distr_test = test['Movement'].describe()
test_distribution_down_movement_perc = int(distr_test[3]) / int(distr_test[0])
test_distribution_down_movement_perc 
test_distribution_up_movement_perc = int(distr_test[0] - distr_test[3]) / int(distr_test[0])
test_distribution_up_movement_perc 


print(f" train UP: {train_distribution_up_movement_perc:.3f}\n train DOWN: {train_distribution_down_movement_perc :.3f}\n test UP: {test_distribution_up_movement_perc:.3f}\n test DOWN:{test_distribution_down_movement_perc:.3f} ")
```

Can see that the distribution between the binary up/down variables is fairly consistent. Train is slightly up only means that up until 08/29/2025 market did a little better overall.


Want to melt the data so can see overall how good of a predictor each variable is

```{python}
melted_data = data.melt(
    
    id_vars=['Date', 'Ticker', 'Movement'], 
    
    value_vars=[
       'Open', 'High', 'Low', 'Close', 'Volume', 'Day_Range',
       'SMA_5', 'SMA_12', 'SMA_15', 'SMA_20', 'SMA_26', 'SMA_30', 'SMA_50',
       'EMA_5', 'EMA_12', 'EMA_26', 'EMA_50', 'MACD', 'RSI',
       'Bollinger_Band_Middle', 'SD', 'Bollinger_Band_Upper',
       'Bollinger_Band_Lower', 'OBV', '^VIX', 'EPS Estimate', 'Reported EPS',
       'Surprise(%)', 'earnings_bool', 'Split Ratio', 'Split_Indicator',
       'weekly_averages', 'Weekly_SD', 'Two_week_averages', 'Two_Week_SD ',
       'Monthly_SD', 'Monthly_Average', 'Daily_Return', 'Day_to_Day_Diff',
       'Day_to_Day_Percent_Diff', 'Five_Day_Percent_Diff',
       'Two_Week_Percent_Diff', 'Monthly_Percent_Diff'],
       
    var_name='Metric',
    value_name='Value'
)
```

```{python}
plot1 = (
    ggplot(melted_data, aes(x='Value'))
    + geom_density(aes(fill='Movement'), alpha=0.5)
    + facet_wrap('~Metric', scales='free')
    + labs(
        title='Density Distribution of Technical Indicators by Daily Price Movement',
        x='Value of Metric',
        fill='Price Movement'
    )
    + theme_minimal()
)

plot1.save(filename='density_plot_by_movement.jpg', width=10, height=8, units='in', dpi=300)
```

Need to determine optimal # of iterations next